const checkbox=document.getElementById("checkbox"),htmlElement=document.documentElement,savedTheme=localStorage.getItem("theme")||"light";htmlElement.setAttribute("data-theme",savedTheme),"dark"===savedTheme&&(checkbox.checked=!0),checkbox.addEventListener("change",function(){const t=this.checked?"dark":"light";htmlElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)});class SuperscoreCalculator{constructor(){this.testCount=2,this.scores={test1:{math:null,rw:null,date:null},test2:{math:null,rw:null,date:null},test3:{math:null,rw:null,date:null},test4:{math:null,rw:null,date:null}},this.init()}init(){for(let t=1;t<=4;t++){const e=document.getElementById(`test${t}-math`),n=document.getElementById(`test${t}-rw`),s=document.getElementById(`test${t}-date`);e&&(e.addEventListener("input",()=>{this.handleScoreInput(t,"math"),this.validateScoreRealtime(t,"math")}),e.addEventListener("blur",()=>this.validateScore(t,"math"))),n&&(n.addEventListener("input",()=>{this.handleScoreInput(t,"rw"),this.validateScoreRealtime(t,"rw")}),n.addEventListener("blur",()=>this.validateScore(t,"rw"))),s&&s.addEventListener("change",()=>this.handleDateInput(t))}const t=document.getElementById("add-test-btn");t&&t.addEventListener("click",()=>this.addTestDate());const e=document.getElementById("reset-btn");e&&e.addEventListener("click",()=>this.reset())}handleScoreInput(t,e){const n=document.getElementById(`test${t}-${e}`),s=n.value;n.value=s.replace(/[^0-9]/g,"");const o=parseInt(n.value);isNaN(o)?this.scores[`test${t}`][e]=null:this.scores[`test${t}`][e]=o,this.calculateTestTotal(t),this.calculateSuperscore()}handleDateInput(t){const e=document.getElementById(`test${t}-date`);this.scores[`test${t}`].date=e.value,this.calculateSuperscore()}validateScoreRealtime(t,e){const n=document.getElementById(`test${t}-${e}`),s=document.getElementById(`test${t}-${e}-error`),o=parseInt(n.value);n.classList.remove("valid","invalid"),s.textContent="",""!==n.value&&(!isNaN(o)&&o>=200&&o<=800&&o%10==0?n.classList.add("valid"):""!==n.value&&(n.classList.add("invalid"),isNaN(o)||o<200||o>800?s.textContent="Enter a score between 200-800 (multiples of 10)":o%10!=0&&(s.textContent="Score must be a multiple of 10")))}validateScore(t,e){const n=document.getElementById(`test${t}-${e}`),s=document.getElementById(`test${t}-${e}-error`),o=parseInt(n.value);if(s.textContent="",n.classList.remove("valid","invalid"),n.style.borderColor="",""===n.value)return!0;if(isNaN(o)||o<200||o>800)return s.textContent="Score must be between 200 and 800",n.classList.add("invalid"),!1;if(o%10!=0){s.textContent="Score must be a multiple of 10",n.classList.add("invalid");const l=10*Math.round(o/10);return n.value=Math.min(800,Math.max(200,l)),this.scores[`test${t}`][e]=parseInt(n.value),this.calculateTestTotal(t),this.showLoadingState(),setTimeout(()=>{this.calculateSuperscore(),this.hideLoadingState()},100),!1}return n.classList.add("valid"),!0}calculateTestTotal(t){const e=this.scores[`test${t}`].math,n=this.scores[`test${t}`].rw,s=document.getElementById(`test${t}-total`);if(null!==e&&null!==n){const t=e+n;s.textContent=t,s.style.color="var(--success-color)",s.style.fontWeight="600"}else s.textContent="-",s.style.color="",s.style.fontWeight=""}calculateSuperscore(){let t={score:null,test:null,date:null},e={score:null,test:null,date:null},n={score:null,test:null},s=0;for(let o=1;o<=4;o++){const l=this.scores[`test${o}`];if(null!==l.math&&null!==l.rw){s++,(null===t.score||l.math>t.score)&&(t={score:l.math,test:o,date:l.date}),(null===e.score||l.rw>e.score)&&(e={score:l.rw,test:o,date:l.date});const r=l.math+l.rw;(null===n.score||r>n.score)&&(n={score:r,test:o})}}if(s>0){document.getElementById("best-math").textContent=t.score;const o=document.getElementById("best-math-date");if(t.date){const e=new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});o.textContent=`from Test ${t.test} (${e})`}else o.textContent=`from Test ${t.test}`;o.style.display="block",o.style.fontSize="0.875rem",o.style.color="var(--secondary-color)",o.style.marginTop="0.5rem",document.getElementById("best-rw").textContent=e.score;const l=document.getElementById("best-rw-date");if(e.date){const t=new Date(e.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});l.textContent=`from Test ${e.test} (${t})`}else l.textContent=`from Test ${e.test}`;l.style.display="block",l.style.fontSize="0.875rem",l.style.color="var(--secondary-color)",l.style.marginTop="0.5rem";const r=t.score+e.score;if(document.getElementById("superscore-total").textContent=r,s>1){document.getElementById("comparison").style.display="block",document.getElementById("best-single").textContent=n.score,document.getElementById("superscore-comparison").textContent=r;const t=r-n.score,e=document.getElementById("improvement");t>0?(e.textContent=`+${t} points`,e.style.color="var(--success-color)"):(e.textContent="No improvement",e.style.color="var(--secondary-color)")}else document.getElementById("comparison").style.display="none"}else document.getElementById("best-math").textContent="-",document.getElementById("best-math-date").textContent="",document.getElementById("best-rw").textContent="-",document.getElementById("best-rw-date").textContent="",document.getElementById("superscore-total").textContent="-",document.getElementById("comparison").style.display="none";this.highlightBestScores(t,e)}highlightBestScores(t,e){for(let t=1;t<=4;t++){const e=document.getElementById(`test${t}-math`),n=document.getElementById(`test${t}-rw`);e&&(e.style.borderColor="",e.style.backgroundColor=""),n&&(n.style.borderColor="",n.style.backgroundColor="")}if(t.test){const e=document.getElementById(`test${t.test}-math`);e&&e.value&&(e.style.borderColor="var(--success-color)",e.style.backgroundColor="rgba(34, 197, 94, 0.05)",e.style.borderWidth="2px")}if(e.test){const t=document.getElementById(`test${e.test}-rw`);t&&t.value&&(t.style.borderColor="var(--success-color)",t.style.backgroundColor="rgba(34, 197, 94, 0.05)",t.style.borderWidth="2px")}}addTestDate(){if(this.testCount>=4)return;this.testCount++;const t=document.getElementById(`test-date-${this.testCount}`);t&&(t.style.display="block"),this.testCount>=4&&(document.getElementById("add-test-btn").style.display="none")}reset(){if(confirm("Are you sure you want to reset all scores?")){this.scores={test1:{math:null,rw:null,date:null},test2:{math:null,rw:null,date:null},test3:{math:null,rw:null,date:null},test4:{math:null,rw:null,date:null}};for(let t=1;t<=4;t++){const e=document.getElementById(`test${t}-math`),n=document.getElementById(`test${t}-rw`),s=document.getElementById(`test${t}-date`),o=document.getElementById(`test${t}-total`),l=document.getElementById(`test${t}-math-error`),r=document.getElementById(`test${t}-rw-error`);e&&(e.value="",e.style.borderColor="",e.style.backgroundColor="",e.style.borderWidth="",e.classList.remove("valid","invalid")),n&&(n.value="",n.style.borderColor="",n.style.backgroundColor="",n.style.borderWidth="",n.classList.remove("valid","invalid")),s&&(s.value=""),o&&(o.textContent="-"),l&&(l.textContent=""),r&&(r.textContent="")}this.testCount=2,document.getElementById("test-date-3").style.display="none",document.getElementById("test-date-4").style.display="none",document.getElementById("add-test-btn").style.display="block",document.getElementById("best-math").textContent="-",document.getElementById("best-math-date").textContent="",document.getElementById("best-rw").textContent="-",document.getElementById("best-rw-date").textContent="",document.getElementById("superscore-total").textContent="-",document.getElementById("comparison").style.display="none"}}showLoadingState(){const t=document.querySelector(".superscore-results");t&&!t.querySelector(".results-loading")&&(t.style.opacity="0.6")}hideLoadingState(){const t=document.querySelector(".superscore-results");t&&(t.style.opacity="1")}}document.addEventListener("DOMContentLoaded",function(){new SuperscoreCalculator});